#! /usr/bin/env node
/**
 * @file                init-dcpconfig.simple
 *                      This test ensures that the dcpConfig is probably correctly
 *                      initialized from the running scheduler when loaded via init.
 *
 * @author              Wes Garland, wes@kingsds.network
 * @date                Jun 2022
 */

process.exitCode = 1;
const assert = require('assert').strict;  

async function main()
{
  const wallet = require('dcp/wallet');

  if (!global.hasOwnProperty('dcpConfig'))
    global.dcpConfig = require('dcp/dcp-config');

  debugger;
  assert.equal(dcpConfig.scheduler.location.constructor.name, "dcpUrl$$DcpURL");
  assert.equal(dcpConfig.scheduler.identity instanceof Promise, true);
  const identity = await dcpConfig.scheduler.identity;
  assert.equal(typeof identity, 'string'); /* this should be Address someday */

  assert(dcpConfig === require('dcp/dcp-config'));

  // Test succeeded, return 0 as exit code for process.exit in .then
  return 0;
}

require('../index').init().then(main).then(process.exit);
