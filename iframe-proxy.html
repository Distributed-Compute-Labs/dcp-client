<!-- 
               iframe-proxy.html

  Set this html as the src of an iframe in order to
  load files relative to it without triggering cross-origin
  checks. The `src` property must include the `relative-url`
  param in order for this proxy to fetch anything.

  Example src: //mycdn.kittens.org/iframe-proxy.html?relative-url=.%2Fpath%2Fto%2Fresource.js

  Note that relative paths must start with a ./ (where %2F is slash).

 -->
 <html>
  <head></head>
  <script>
  async function go() {
    const params = new URLSearchParams(window.location.search);

    // relative-url
    const relativePath = params.get("relative-url");
    if (relativePath.indexOf("./") !== 0)
      throw new Error(`Relative path for iframe proxy must start with './', got: "${relativePath}"`);
    
    const content = await (await fetch(relativePath)).text();
    window.parent.postMessage(content, '*');
  }
  </script>
<body onload="go();"></body>
</html>